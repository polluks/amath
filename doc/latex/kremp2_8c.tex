\hypertarget{kremp2_8c}{}\section{lib/real/kremp2.c File Reference}
\label{kremp2_8c}\index{lib/real/kremp2.\+c@{lib/real/kremp2.\+c}}
{\ttfamily \#include \char`\"{}prim.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}math.\+h\char`\"{}}\\*
Include dependency graph for kremp2.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=190pt]{kremp2_8c__incl}
\end{center}
\end{figure}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{kremp2_8c_a8a5e87d33974881295c4ed0d09732f71}{\+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2} (double $\ast$x, double $\ast$y, int e0, int nx, int prec, const int $\ast$ipio2)
\begin{DoxyCompactList}\small\item\em Kernel reduction function. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static const int \hyperlink{kremp2_8c_a591225cae5038cecf9ef2fb8d0bc9b38}{init\+\_\+jk} \mbox{[}$\,$\mbox{]} = \{2,3,4,6\}
\item 
static const double \hyperlink{kremp2_8c_a1fe3f83e715fb3fb06eafc76dc16c79d}{P\+Io2} \mbox{[}$\,$\mbox{]}
\item 
static const double \hyperlink{kremp2_8c_a554f7b66b1ba49443447eb746978c268}{zero} = 0.\+0
\item 
static const double \hyperlink{kremp2_8c_ada85e349d35971b32c8ea4238881ff8b}{one} = 1.\+0
\item 
static const double \hyperlink{kremp2_8c_a578df73908b4f4182b101d31c7675202}{two24} = 1.\+67772160000000000000e+07
\item 
static const double \hyperlink{kremp2_8c_af34c3d59756eba41a4ba7ae5c403f432}{twon24} = 5.\+96046447753906250000e-\/08
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{kremp2.\+c@{kremp2.\+c}!\+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2@{\+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2}}
\index{\+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2@{\+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{\+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2(double $\ast$x, double $\ast$y, int e0, int nx, int prec, const int $\ast$ipio2)}{__kernel_rem_pio2(double *x, double *y, int e0, int nx, int prec, const int *ipio2)}}]{\setlength{\rightskip}{0pt plus 5cm}int \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2 (
\begin{DoxyParamCaption}
\item[{double $\ast$}]{x, }
\item[{double $\ast$}]{y, }
\item[{int}]{e0, }
\item[{int}]{nx, }
\item[{int}]{prec, }
\item[{const int $\ast$}]{ipio2}
\end{DoxyParamCaption}
)}\hypertarget{kremp2_8c_a8a5e87d33974881295c4ed0d09732f71}{}\label{kremp2_8c_a8a5e87d33974881295c4ed0d09732f71}


Kernel reduction function. 

\begin{DoxyVersion}{Version}
1.\+4 
\end{DoxyVersion}
\begin{DoxyDate}{Date}
96/03/07
\end{DoxyDate}

\begin{DoxyPre}
\_\_kernel\_rem\_pio2(x,y,e0,nx,prec,ipio2)
double x[],y[]; int e0,nx,prec; int ipio2[];\end{DoxyPre}



\begin{DoxyPre}\_\_kernel\_rem\_pio2 return the last three digits of N with
    y = x - N*pi/2
so that |y| < pi/2.\end{DoxyPre}



\begin{DoxyPre}The method is to compute the integer (mod 8) and fraction parts of
(2/pi)*x without doing the full multiplication. In general we
skip the part of the product that are known to be a huge integer (
more accurately, = 0 mod 8 ). Thus the number of operations are
independent of the exponent of the input.\end{DoxyPre}



\begin{DoxyPre}(2/pi) is represented by an array of 24-bit integers in ipio2[].\end{DoxyPre}



\begin{DoxyPre}Input parameters:
    x[] The input value (must be positive) is broken into nx
    pieces of 24-bit integers in double precision format.
    x[i] will be the i-th 24 bit of x. The scaled exponent
    of x[0] is given in input parameter e0 (i.e., x[0]*2^e0
    match x's up to 24 bits.\end{DoxyPre}



\begin{DoxyPre}    Example of breaking a double positive z into x[0]+x[1]+x[2]:
        e0 = ilogb(z)-23
        z  = scalbn(z,-e0)
    for i = 0,1,2
        x[i] = floor(z)
        z    = (z-x[i])*2**24\end{DoxyPre}



\begin{DoxyPre} y[]    ouput result in an array of double precision numbers.
    The dimension of y[] is:
        24-bit  precision   1
        53-bit  precision   2
        64-bit  precision   2
        113-bit precision   3
    The actual value is the sum of them. Thus for 113-bit
    precison, one may have to do something like:\end{DoxyPre}



\begin{DoxyPre}    long double t,w,r\_head, r\_tail;
    t = (long double)y[2] + (long double)y[1];
    w = (long double)y[0];
    r\_head = t+w;
    r\_tail = w - (r\_head - t);\end{DoxyPre}



\begin{DoxyPre} e0 The exponent of x[0]\end{DoxyPre}



\begin{DoxyPre} nx dimension of x[]\end{DoxyPre}



\begin{DoxyPre}    prec    an integer indicating the precision:
        0   24  bits (single)
        1   53  bits (double)
        2   64  bits (extended)
        3   113 bits (quad)\end{DoxyPre}



\begin{DoxyPre} ipio2[]
    integer array, contains the (24*i)-th to (24*i+23)-th
    bit of 2/pi after binary point. The corresponding
    floating value is\end{DoxyPre}



\begin{DoxyPre}        ipio2[i] * 2^(-24(i+1)).\end{DoxyPre}



\begin{DoxyPre}External function:
 double \hyperlink{math_8h_a0353978ec1ae247f2d95f2dc75856ed6}{scalbn()}, \hyperlink{math_8h_a6de60a3e907dcf0bfe3ea8d64f1e8873}{floor()};\end{DoxyPre}



\begin{DoxyPre}Here is the description of some local variables:\end{DoxyPre}



\begin{DoxyPre}    jk  jk+1 is the initial number of terms of ipio2[] needed
    in the computation. The recommended value is 2,3,4,
    6 for single, double, extended,and quad.\end{DoxyPre}



\begin{DoxyPre}    jz  local integer variable indicating the number of
    terms of ipio2[] used.\end{DoxyPre}



\begin{DoxyPre} jx nx - 1\end{DoxyPre}



\begin{DoxyPre} jv index for pointing to the suitable ipio2[] for the
    computation. In general, we want
        ( 2^e0*x[0] * ipio2[jv-1]*2^(-24jv) )/8
    is an integer. Thus
        e0-3-24*jv >= 0 or (e0-3)/24 >= jv
    Hence jv = max(0,(e0-3)/24).\end{DoxyPre}



\begin{DoxyPre} jp jp+1 is the number of terms in PIo2[] needed, jp = jk.\end{DoxyPre}



\begin{DoxyPre}    q[] double array with integral value, representing the
    24-bits chunk of the product of x and 2/pi.\end{DoxyPre}



\begin{DoxyPre} q0 the corresponding exponent of q[0]. Note that the
    exponent for q[i] would be q0-24*i.\end{DoxyPre}



\begin{DoxyPre} PIo2[] double precision array, obtained by cutting pi/2
    into 24 bits chunks.\end{DoxyPre}



\begin{DoxyPre} f[]    ipio2[] in floating point\end{DoxyPre}



\begin{DoxyPre} iq[]   integer array by breaking up q[] in 24-bits chunk.\end{DoxyPre}



\begin{DoxyPre} fq[]   final product of x*(2/pi) in fq[0],..,fq[jk]\end{DoxyPre}



\begin{DoxyPre} ih integer. If >0 it indicates q[] is >= 0.5, hence
    it also indicates the *sign* of the result.\end{DoxyPre}



\begin{DoxyPre}\end{DoxyPre}
 \begin{DoxyCopyright}{Copyright}
Copyright (C) 1993 by Sun Microsystems, Inc. All rights reserved.  Developed at Sun\+Soft, a Sun Microsystems, Inc. business. Permission to use, copy, modify, and distribute this software is freely granted, provided that this notice is preserved. 
\end{DoxyCopyright}


Definition at line 190 of file kremp2.\+c.



References init\+\_\+jk, one, P\+Io2, scalbn(), two24, twon24, and zero.



Referenced by rempio2().


\begin{DoxyCode}
191 \{
192     \textcolor{keywordtype}{int} jz,jx,jv,jp,jk,carry,n,iq[20],i,j,k,m,q0,ih;
193     \textcolor{keywordtype}{double} z,fw,f[20],fq[20],q[20];
194 
195     \textcolor{comment}{/* initialize jk*/}
196     jk = \hyperlink{kremp2_8c_a591225cae5038cecf9ef2fb8d0bc9b38}{init\_jk}[prec];
197     jp = jk;
198 
199     \textcolor{comment}{/* determine jx,jv,q0, note that 3>q0 */}
200     jx =  nx-1;
201     jv = (e0-3)/24;
202     \textcolor{keywordflow}{if}(jv<0) jv=0;
203     q0 =  e0-24*(jv+1);
204 
205     \textcolor{comment}{/* set up f[0] to f[jx+jk] where f[jx+jk] = ipio2[jv+jk] */}
206     j = jv-jx;
207     m = jx+jk;
208     \textcolor{keywordflow}{for}(i=0; i<=m; i++,j++) f[i] = (j<0)? \hyperlink{kremp2_8c_a554f7b66b1ba49443447eb746978c268}{zero} : (double) ipio2[j];
209 
210     \textcolor{comment}{/* compute q[0],q[1],...q[jk] */}
211     \textcolor{keywordflow}{for} (i=0; i<=jk; i++) \{
212         \textcolor{keywordflow}{for}(j=0,fw=0.0; j<=jx; j++) fw += x[j]*f[jx+i-j];
213         q[i] = fw;
214     \}
215 
216     jz = jk;
217 recompute:
218     \textcolor{comment}{/* distill q[] into iq[] reversingly */}
219     \textcolor{keywordflow}{for}(i=0,j=jz,z=q[jz]; j>0; i++,j--) \{
220         fw    =  (double)((\textcolor{keywordtype}{int})(\hyperlink{kremp2_8c_af34c3d59756eba41a4ba7ae5c403f432}{twon24}* z));
221         iq[i] =  (int)(z-\hyperlink{kremp2_8c_a578df73908b4f4182b101d31c7675202}{two24}*fw);
222         z     =  q[j-1]+fw;
223     \}
224 
225     \textcolor{comment}{/* compute n */}
226     z  = \hyperlink{math_8h_a0353978ec1ae247f2d95f2dc75856ed6}{scalbn}(z,q0);        \textcolor{comment}{/* actual value of z */}
227     z -= 8.0*\hyperlink{math_8h_a6de60a3e907dcf0bfe3ea8d64f1e8873}{floor}(z*0.125);       \textcolor{comment}{/* trim off integer >= 8 */}
228     n  = (int) z;
229     z -= (double)n;
230     ih = 0;
231     \textcolor{keywordflow}{if}(q0>0) \{  \textcolor{comment}{/* need iq[jz-1] to determine n */}
232         i  = (iq[jz-1]>>(24-q0));
233         n += i;
234         iq[jz-1] -= i<<(24-q0);
235         ih = iq[jz-1]>>(23-q0);
236     \}
237     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(q0==0) ih = iq[jz-1]>>23;
238     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(z>=0.5) ih=2;
239 
240     \textcolor{keywordflow}{if}(ih>0) \{  \textcolor{comment}{/* q > 0.5 */}
241         n += 1;
242         carry = 0;
243         \textcolor{keywordflow}{for}(i=0; i<jz ; i++) \{  \textcolor{comment}{/* compute 1-q */}
244             j = iq[i];
245             \textcolor{keywordflow}{if}(carry==0) \{
246                 \textcolor{keywordflow}{if}(j!=0) \{
247                     carry = 1;
248                     iq[i] = 0x1000000- j;
249                 \}
250             \} \textcolor{keywordflow}{else}  iq[i] = 0xffffff - j;
251         \}
252         \textcolor{keywordflow}{if}(q0>0) \{      \textcolor{comment}{/* rare case: chance is 1 in 12 */}
253             \textcolor{keywordflow}{switch}(q0) \{
254             \textcolor{keywordflow}{case} 1:
255                 iq[jz-1] &= 0x7fffff;
256                 \textcolor{keywordflow}{break};
257             \textcolor{keywordflow}{case} 2:
258                 iq[jz-1] &= 0x3fffff;
259                 \textcolor{keywordflow}{break};
260             \}
261         \}
262         \textcolor{keywordflow}{if}(ih==2) \{
263             z = \hyperlink{kremp2_8c_ada85e349d35971b32c8ea4238881ff8b}{one} - z;
264             \textcolor{keywordflow}{if}(carry!=0) z -= \hyperlink{math_8h_a0353978ec1ae247f2d95f2dc75856ed6}{scalbn}(\hyperlink{kremp2_8c_ada85e349d35971b32c8ea4238881ff8b}{one},q0);
265         \}
266     \}
267 
268     \textcolor{comment}{/* check if recomputation is needed */}
269     \textcolor{keywordflow}{if}(z==\hyperlink{kremp2_8c_a554f7b66b1ba49443447eb746978c268}{zero}) \{
270         j = 0;
271         \textcolor{keywordflow}{for} (i=jz-1; i>=jk; i--) j |= iq[i];
272         \textcolor{keywordflow}{if}(j==0) \{ \textcolor{comment}{/* need recomputation */}
273             \textcolor{keywordflow}{for}(k=1; iq[jk-k]==0; k++); \textcolor{comment}{/* k = no. of terms needed */}
274 
275             \textcolor{keywordflow}{for}(i=jz+1; i<=jz+k; i++) \{ \textcolor{comment}{/* add q[jz+1] to q[jz+k] */}
276                 f[jx+i] = (double) ipio2[jv+i];
277                 \textcolor{keywordflow}{for}(j=0,fw=0.0; j<=jx; j++) fw += x[j]*f[jx+i-j];
278                 q[i] = fw;
279             \}
280             jz += k;
281             \textcolor{keywordflow}{goto} recompute;
282         \}
283     \}
284 
285     \textcolor{comment}{/* chop off zero terms */}
286     \textcolor{keywordflow}{if}(z==0.0) \{
287         jz -= 1;
288         q0 -= 24;
289         \textcolor{keywordflow}{while}(iq[jz]==0) \{
290             jz--;
291             q0-=24;
292         \}
293     \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{/* break z into 24-bit if necessary */}
294         z = \hyperlink{math_8h_a0353978ec1ae247f2d95f2dc75856ed6}{scalbn}(z,-q0);
295         \textcolor{keywordflow}{if}(z>=\hyperlink{kremp2_8c_a578df73908b4f4182b101d31c7675202}{two24}) \{
296             fw = (double)((\textcolor{keywordtype}{int})(\hyperlink{kremp2_8c_af34c3d59756eba41a4ba7ae5c403f432}{twon24}*z));
297             iq[jz] = (int)(z-\hyperlink{kremp2_8c_a578df73908b4f4182b101d31c7675202}{two24}*fw);
298             jz += 1;
299             q0 += 24;
300             iq[jz] = (int) fw;
301         \} \textcolor{keywordflow}{else} iq[jz] = (int) z ;
302     \}
303 
304     \textcolor{comment}{/* convert integer "bit" chunk to floating-point value */}
305     fw = \hyperlink{math_8h_a0353978ec1ae247f2d95f2dc75856ed6}{scalbn}(\hyperlink{kremp2_8c_ada85e349d35971b32c8ea4238881ff8b}{one},q0);
306     \textcolor{keywordflow}{for}(i=jz; i>=0; i--) \{
307         q[i] = fw*(double)iq[i];
308         fw*=\hyperlink{kremp2_8c_af34c3d59756eba41a4ba7ae5c403f432}{twon24};
309     \}
310 
311     \textcolor{comment}{/* compute PIo2[0,...,jp]*q[jz,...,0] */}
312     \textcolor{keywordflow}{for}(i=jz; i>=0; i--) \{
313         \textcolor{keywordflow}{for}(fw=0.0,k=0; k<=jp&&k<=jz-i; k++) fw += \hyperlink{kremp2_8c_a1fe3f83e715fb3fb06eafc76dc16c79d}{PIo2}[k]*q[i+k];
314         fq[jz-i] = fw;
315     \}
316 
317     \textcolor{comment}{/* compress fq[] into y[] */}
318     \textcolor{keywordflow}{switch}(prec) \{
319     \textcolor{keywordflow}{case} 0:
320         fw = 0.0;
321         \textcolor{keywordflow}{for} (i=jz; i>=0; i--) fw += fq[i];
322         y[0] = (ih==0)? fw: -fw;
323         \textcolor{keywordflow}{break};
324     \textcolor{keywordflow}{case} 1:
325     \textcolor{keywordflow}{case} 2:
326         fw = 0.0;
327         \textcolor{keywordflow}{for} (i=jz; i>=0; i--) fw += fq[i];
328         y[0] = (ih==0)? fw: -fw;
329         fw = fq[0]-fw;
330         \textcolor{keywordflow}{for} (i=1; i<=jz; i++) fw += fq[i];
331         y[1] = (ih==0)? fw: -fw;
332         \textcolor{keywordflow}{break};
333     \textcolor{keywordflow}{case} 3: \textcolor{comment}{/* painful */}
334         \textcolor{keywordflow}{for} (i=jz; i>0; i--) \{
335             fw      = fq[i-1]+fq[i];
336             fq[i]  += fq[i-1]-fw;
337             fq[i-1] = fw;
338         \}
339         \textcolor{keywordflow}{for} (i=jz; i>1; i--) \{
340             fw      = fq[i-1]+fq[i];
341             fq[i]  += fq[i-1]-fw;
342             fq[i-1] = fw;
343         \}
344         \textcolor{keywordflow}{for} (fw=0.0,i=jz; i>=2; i--) fw += fq[i];
345         \textcolor{keywordflow}{if}(ih==0) \{
346             y[0] =  fq[0];
347             y[1] =  fq[1];
348             y[2] =  fw;
349         \} \textcolor{keywordflow}{else} \{
350             y[0] = -fq[0];
351             y[1] = -fq[1];
352             y[2] = -fw;
353         \}
354     \}
355     \textcolor{keywordflow}{return} n&7;
356 \}
\end{DoxyCode}


Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=259pt]{kremp2_8c_a8a5e87d33974881295c4ed0d09732f71_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{kremp2_8c_a8a5e87d33974881295c4ed0d09732f71_icgraph}
\end{center}
\end{figure}




\subsection{Variable Documentation}
\index{kremp2.\+c@{kremp2.\+c}!init\+\_\+jk@{init\+\_\+jk}}
\index{init\+\_\+jk@{init\+\_\+jk}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{init\+\_\+jk}{init_jk}}]{\setlength{\rightskip}{0pt plus 5cm}const int init\+\_\+jk\mbox{[}$\,$\mbox{]} = \{2,3,4,6\}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{kremp2_8c_a591225cae5038cecf9ef2fb8d0bc9b38}{}\label{kremp2_8c_a591225cae5038cecf9ef2fb8d0bc9b38}


Definition at line 54 of file kremp2.\+c.



Referenced by \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2().

\index{kremp2.\+c@{kremp2.\+c}!one@{one}}
\index{one@{one}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{one}{one}}]{\setlength{\rightskip}{0pt plus 5cm}const double one = 1.\+0\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{kremp2_8c_ada85e349d35971b32c8ea4238881ff8b}{}\label{kremp2_8c_ada85e349d35971b32c8ea4238881ff8b}


Definition at line 69 of file kremp2.\+c.



Referenced by \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2().

\index{kremp2.\+c@{kremp2.\+c}!P\+Io2@{P\+Io2}}
\index{P\+Io2@{P\+Io2}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{P\+Io2}{PIo2}}]{\setlength{\rightskip}{0pt plus 5cm}const double P\+Io2\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{kremp2_8c_a1fe3f83e715fb3fb06eafc76dc16c79d}{}\label{kremp2_8c_a1fe3f83e715fb3fb06eafc76dc16c79d}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    1.57079625129699707031e+00, 
    7.54978941586159635335e-08, 
    5.39030252995776476554e-15, 
    3.28200341580791294123e-22, 
    1.27065575308067607349e-29, 
    1.22933308981111328932e-36, 
    2.73370053816464559624e-44, 
    2.16741683877804819444e-51, 
\}
\end{DoxyCode}


Definition at line 56 of file kremp2.\+c.



Referenced by \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2().

\index{kremp2.\+c@{kremp2.\+c}!two24@{two24}}
\index{two24@{two24}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{two24}{two24}}]{\setlength{\rightskip}{0pt plus 5cm}const double two24 = 1.\+67772160000000000000e+07\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{kremp2_8c_a578df73908b4f4182b101d31c7675202}{}\label{kremp2_8c_a578df73908b4f4182b101d31c7675202}


Definition at line 70 of file kremp2.\+c.



Referenced by \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2().

\index{kremp2.\+c@{kremp2.\+c}!twon24@{twon24}}
\index{twon24@{twon24}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{twon24}{twon24}}]{\setlength{\rightskip}{0pt plus 5cm}const double twon24 = 5.\+96046447753906250000e-\/08\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{kremp2_8c_af34c3d59756eba41a4ba7ae5c403f432}{}\label{kremp2_8c_af34c3d59756eba41a4ba7ae5c403f432}


Definition at line 71 of file kremp2.\+c.



Referenced by \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2().

\index{kremp2.\+c@{kremp2.\+c}!zero@{zero}}
\index{zero@{zero}!kremp2.\+c@{kremp2.\+c}}
\subsubsection[{\texorpdfstring{zero}{zero}}]{\setlength{\rightskip}{0pt plus 5cm}const double zero = 0.\+0\hspace{0.3cm}{\ttfamily [static]}}\hypertarget{kremp2_8c_a554f7b66b1ba49443447eb746978c268}{}\label{kremp2_8c_a554f7b66b1ba49443447eb746978c268}


Definition at line 68 of file kremp2.\+c.



Referenced by \+\_\+\+\_\+kernel\+\_\+rem\+\_\+pio2().

